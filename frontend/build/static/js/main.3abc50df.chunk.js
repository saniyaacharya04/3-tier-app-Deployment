(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{24:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(6),s=a.n(o),c=(a(24),a(5)),l=a(2),i=a(19),d=a(7),u=a.n(d);const j="http://52.91.149.139:8080/api",b=u.a.create({baseURL:j});u.a.create({baseURL:"".concat(j,"/users")}),u.a.create({baseURL:"".concat(j,"/tasks")});var g=b;var m=a(3);function h(e){let{onLogin:t}=e;const[a,n]=Object(r.useState)(""),[o,s]=Object(r.useState)(""),[c,i]=Object(r.useState)(""),d=Object(l.q)();return Object(m.jsxs)("div",{children:[Object(m.jsx)("h2",{children:"Login"}),Object(m.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{var r,n;const e=await(l={email:a,password:o},g.post("/users/login",l));null!==(r=e.data)&&void 0!==r&&r.user&&null!==(n=e.data)&&void 0!==n&&n.token?(localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),t(e.data.user),d("/tasks")):i("Invalid response from server")}catch(u){var s,c;i((null===(s=u.response)||void 0===s||null===(c=s.data)||void 0===c?void 0:c.error)||"Server error, please try again later.")}var l},children:[Object(m.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>n(e.target.value),required:!0}),Object(m.jsx)("input",{type:"password",placeholder:"Password",value:o,onChange:e=>s(e.target.value),required:!0}),Object(m.jsx)("button",{type:"submit",children:"Login"})]}),c&&Object(m.jsx)("p",{style:{color:"red"},children:c})]})}var p=a(10);var O=function(){const[e,t]=Object(r.useState)({name:"",email:"",password:""}),[a,n]=Object(r.useState)(""),o=Object(l.q)(),s=e=>{t(t=>Object(p.a)(Object(p.a)({},t),{},{[e.target.name]:e.target.value}))};return Object(m.jsxs)("div",{className:"auth-container",children:[Object(m.jsx)("h2",{children:"Register"}),Object(m.jsxs)("form",{onSubmit:async t=>{t.preventDefault();const{name:a,email:r,password:s}=e;var c;if(a&&r&&s)try{await(c={name:a,email:r,password:s},g.post("/users/register",c)),alert("\u2705 Registration successful! Please login."),o("/login")}catch(d){var l,i;n((null===(l=d.response)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.error)||"Registration failed."),console.error("Register error:",d)}else n("All fields are required.")},children:[Object(m.jsx)("input",{type:"text",name:"name",placeholder:"Name",value:e.name,onChange:s,required:!0}),Object(m.jsx)("input",{type:"email",name:"email",placeholder:"Email",value:e.email,onChange:s,required:!0}),Object(m.jsx)("input",{type:"password",name:"password",placeholder:"Password",value:e.password,onChange:s,required:!0}),Object(m.jsx)("button",{type:"submit",children:"Register"})]}),a&&Object(m.jsx)("p",{style:{color:"red"},children:a}),Object(m.jsx)("p",{onClick:()=>o("/login"),style:{cursor:"pointer",color:"#007bff"},children:"Already have an account? Login"})]})};function v(e){let{user:t,onLogout:a}=e;const[n,o]=Object(r.useState)(""),[s,c]=Object(r.useState)(""),[l,i]=Object(r.useState)([]),[d,u]=Object(r.useState)(null),[j,b]=Object(r.useState)(""),h=localStorage.getItem("token"),p=null!==t&&void 0!==t&&t.id?t:JSON.parse(localStorage.getItem("user"));Object(r.useEffect)(()=>{null!==p&&void 0!==p&&p.id||(console.warn("User ID missing \u2014 redirecting to login"),a())},[p,a]);const O=()=>{u(null),b("")},v=async()=>{try{const e=await g.put("/tasks/".concat(d),{title:j},{headers:{Authorization:"Bearer ".concat(h)}});i(l.map(t=>t.id===d?e.data:t)),O()}catch(e){console.error("Failed to update task:",e)}};return Object(r.useEffect)(()=>{(async()=>{try{const e=await g.get("/tasks",{headers:{Authorization:"Bearer ".concat(h)}});i(e.data)}catch(e){console.error("Failed to fetch tasks:",e)}})()},[]),Object(m.jsxs)("div",{style:{padding:"2rem"},children:[Object(m.jsxs)("h2",{children:["Welcome, ",(null===p||void 0===p?void 0:p.name)||"User"]}),Object(m.jsxs)("div",{style:{marginBottom:"1rem"},children:[Object(m.jsx)("input",{value:n,onChange:e=>o(e.target.value),placeholder:"New task",style:{padding:"0.5rem",width:"300px"}}),Object(m.jsx)("input",{value:s,onChange:e=>c(e.target.value),placeholder:"Description",style:{padding:"0.5rem",width:"300px",marginLeft:"1rem"}}),Object(m.jsx)("button",{onClick:async()=>{if(null===p||void 0===p||!p.id||!n.trim())return alert("User ID and task title are required"),void console.log("Debug:",{userId:null===p||void 0===p?void 0:p.id,task:n});const e={user_id:p.id,title:n,description:s||"",status:"pending"};try{const t=await g.post("/tasks",e,{headers:{Authorization:"Bearer ".concat(h)}});i([...l,t.data]),o(""),c("")}catch(t){console.error("Failed to create task:",t),alert("\u274c Task creation failed")}},style:{marginLeft:"1rem"},children:"Add Task"})]}),Object(m.jsx)("ul",{children:l.map(e=>Object(m.jsx)("li",{style:{marginBottom:"0.5rem"},children:d===e.id?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("input",{value:j,onChange:e=>b(e.target.value),style:{padding:"0.3rem",width:"250px"}}),Object(m.jsx)("button",{onClick:v,style:{marginLeft:"0.5rem"},children:"Save"}),Object(m.jsx)("button",{onClick:O,style:{marginLeft:"0.5rem"},children:"Cancel"})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("strong",{children:e.title})," \u2014 ",e.description,Object(m.jsx)("button",{onClick:()=>(e=>{u(e.id),b(e.title)})(e),style:{marginLeft:"1rem"},children:"Edit"}),Object(m.jsx)("button",{onClick:()=>(async e=>{try{await g.delete("/tasks/".concat(e),{headers:{Authorization:"Bearer ".concat(h)}}),i(l.filter(t=>t.id!==e))}catch(t){console.error("Failed to delete task:",t)}})(e.id),style:{marginLeft:"0.5rem"},children:"Delete"})]})},e.id))}),Object(m.jsx)("button",{onClick:a,style:{marginTop:"2rem"},children:"Logout"})]})}var x=function(){const[e,t]=Object(r.useState)(null),[a,n]=Object(r.useState)(!0);Object(r.useEffect)(()=>{const e=localStorage.getItem("token"),a=localStorage.getItem("user");if(e)try{const{exp:r}=Object(i.a)(e);if(Date.now()>=1e3*r)localStorage.clear(),t(null),window.location.href="/login";else if(a){const e=JSON.parse(a);null!==e&&void 0!==e&&e.id?t(e):(console.warn("User object missing ID"),localStorage.clear(),window.location.href="/login")}}catch(r){console.error("Invalid token:",r),localStorage.clear(),t(null),window.location.href="/login"}n(!1)},[]),Object(r.useEffect)(()=>{e?localStorage.setItem("user",JSON.stringify(e)):localStorage.removeItem("user")},[e]);const o=!!localStorage.getItem("token");return Object(m.jsx)(c.a,{children:Object(m.jsxs)(l.d,{children:[Object(m.jsx)(l.b,{path:"/login",element:Object(m.jsx)(h,{onLogin:t})}),Object(m.jsx)(l.b,{path:"/register",element:Object(m.jsx)(O,{})}),Object(m.jsx)(l.b,{path:"/tasks",element:a?Object(m.jsx)("div",{children:"Loading..."}):o&&null!==e&&void 0!==e&&e.id?Object(m.jsx)(v,{user:e,onLogout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(null),window.location.href="/login"}}):Object(m.jsx)(l.a,{to:"/login",replace:!0})}),Object(m.jsx)(l.b,{path:"*",element:o?Object(m.jsx)(l.a,{to:"/tasks",replace:!0}):Object(m.jsx)(l.a,{to:"/login",replace:!0})})]})})};s.a.render(Object(m.jsx)(n.a.StrictMode,{children:Object(m.jsx)("div",{className:"app-wrapper",children:Object(m.jsx)(x,{})})}),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.3abc50df.chunk.js.map