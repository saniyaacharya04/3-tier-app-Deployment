(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{23:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var r=a(0),c=a.n(r),s=a(6),n=a.n(s),o=(a(23),a(5)),l=a(2),i=a(18),d=a(7),j=a.n(d);const u="http://52.91.149.139:8080/api",b=j.a.create({baseURL:u});j.a.create({baseURL:"".concat(u,"/users")}),j.a.create({baseURL:"".concat(u,"/tasks")});var h=b;var g=a(3);function O(e){let{onLogin:t}=e;const[a,c]=Object(r.useState)(""),[s,n]=Object(r.useState)(""),[o,i]=Object(r.useState)(""),d=Object(l.q)();return Object(g.jsxs)("div",{children:[Object(g.jsx)("h2",{children:"Login"}),Object(g.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{var r,c;const e=await(l={email:a,password:s},h.post("/users/login",l));null!==(r=e.data)&&void 0!==r&&r.user&&null!==(c=e.data)&&void 0!==c&&c.token?(localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),t(e.data.user),d("/tasks")):i("Invalid response from server")}catch(j){var n,o;i((null===(n=j.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.error)||"Server error, please try again later.")}var l},children:[Object(g.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>c(e.target.value),required:!0}),Object(g.jsx)("input",{type:"password",placeholder:"Password",value:s,onChange:e=>n(e.target.value),required:!0}),Object(g.jsx)("button",{type:"submit",children:"Login"})]}),o&&Object(g.jsx)("p",{style:{color:"red"},children:o})]})}var p=function(){const[e,t]=Object(r.useState)(""),[a,c]=Object(r.useState)(""),[s,n]=Object(r.useState)(""),o=Object(l.q)();return Object(g.jsxs)("div",{className:"auth-container",children:[Object(g.jsx)("h2",{children:"Register"}),Object(g.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{await(s={email:e,password:a},h.post("/users/register",s)),alert("\u2705 Registration successful! Please login."),o("/login")}catch(l){var r,c;n((null===(r=l.response)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.error)||"Registration failed."),console.error("Register error:",l)}var s},children:[Object(g.jsx)("input",{type:"email",placeholder:"Email",value:e,onChange:e=>t(e.target.value),required:!0}),Object(g.jsx)("input",{type:"password",placeholder:"Password",value:a,onChange:e=>c(e.target.value),required:!0}),Object(g.jsx)("button",{type:"submit",children:"Register"})]}),s&&Object(g.jsx)("p",{style:{color:"red"},children:s}),Object(g.jsx)("p",{onClick:()=>o("/login"),style:{cursor:"pointer"},children:"Already have an account? Login"})]})};function m(e){let{user:t,onLogout:a}=e;const[c,s]=Object(r.useState)(""),[n,o]=Object(r.useState)([]),[l,i]=Object(r.useState)(null),[d,j]=Object(r.useState)(""),u=localStorage.getItem("token"),b=()=>{i(null),j("")},O=async()=>{try{const e=await h.put("/tasks/".concat(l),{title:d},{headers:{Authorization:"Bearer ".concat(u)}});o(n.map(t=>t.id===l?e.data:t)),b()}catch(e){console.error("Failed to update task:",e)}};return Object(r.useEffect)(()=>{(async()=>{try{const e=await h.get("/tasks",{headers:{Authorization:"Bearer ".concat(u)}});o(e.data)}catch(e){console.error("Failed to fetch tasks:",e)}})()},[]),Object(g.jsxs)("div",{style:{padding:"2rem"},children:[Object(g.jsxs)("h2",{children:["Welcome, ",t.name]}),Object(g.jsxs)("div",{style:{marginBottom:"1rem"},children:[Object(g.jsx)("input",{value:c,onChange:e=>s(e.target.value),placeholder:"New task",style:{padding:"0.5rem",width:"300px"}}),Object(g.jsx)("button",{onClick:async()=>{try{const e=await h.post("/tasks",{title:c},{headers:{Authorization:"Bearer ".concat(u)}});o([...n,e.data]),s("")}catch(e){console.error("Failed to create task:",e)}},style:{marginLeft:"1rem"},children:"Add Task"})]}),Object(g.jsx)("ul",{children:n.map(e=>Object(g.jsx)("li",{style:{marginBottom:"0.5rem"},children:l===e.id?Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("input",{value:d,onChange:e=>j(e.target.value),style:{padding:"0.3rem",width:"250px"}}),Object(g.jsx)("button",{onClick:O,style:{marginLeft:"0.5rem"},children:"Save"}),Object(g.jsx)("button",{onClick:b,style:{marginLeft:"0.5rem"},children:"Cancel"})]}):Object(g.jsxs)(g.Fragment,{children:[e.title,Object(g.jsx)("button",{onClick:()=>(e=>{i(e.id),j(e.title)})(e),style:{marginLeft:"1rem"},children:"Edit"}),Object(g.jsx)("button",{onClick:()=>(async e=>{try{await h.delete("/tasks/".concat(e),{headers:{Authorization:"Bearer ".concat(u)}}),o(n.filter(t=>t.id!==e))}catch(t){console.error("Failed to delete task:",t)}})(e.id),style:{marginLeft:"0.5rem"},children:"Delete"})]})},e.id))}),Object(g.jsx)("button",{onClick:a,style:{marginTop:"2rem"},children:"Logout"})]})}var x=function(){const[e,t]=Object(r.useState)(null);Object(r.useEffect)(()=>{const e=localStorage.getItem("token"),a=localStorage.getItem("user");if(e)try{const{exp:r}=Object(i.a)(e);Date.now()>=1e3*r?(localStorage.clear(),t(null)):a&&t(JSON.parse(a))}catch(r){console.error("Invalid token:",r),localStorage.clear(),t(null)}},[]),Object(r.useEffect)(()=>{e?localStorage.setItem("user",JSON.stringify(e)):localStorage.removeItem("user")},[e]);const a=!!localStorage.getItem("token");return Object(g.jsx)(o.a,{children:Object(g.jsxs)(l.d,{children:[Object(g.jsx)(l.b,{path:"/login",element:Object(g.jsx)(O,{onLogin:t})}),Object(g.jsx)(l.b,{path:"/register",element:Object(g.jsx)(p,{})}),Object(g.jsx)(l.b,{path:"/tasks",element:a?Object(g.jsx)(m,{user:e,onLogout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(null),window.location.href="/login"}}):Object(g.jsx)(l.a,{to:"/login",replace:!0})}),Object(g.jsx)(l.b,{path:"*",element:Object(g.jsx)(l.a,{to:"/login",replace:!0})})]})})};n.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)("div",{className:"app-wrapper",children:Object(g.jsx)(x,{})})}),document.getElementById("root"))}},[[44,1,2]]]);
//# sourceMappingURL=main.f2d84a76.chunk.js.map